// THIS FILE IS AUTO-GENERATED BY ZWGEN
// DO NOT MODIFY

package {{.CommandClass.GetPackageName}}

{{$version := .CommandClass.Version}}
{{$structName := (.Command.GetStructName .CommandClass)}}

const Command{{$structName}} cc.CommandID = {{.Command.Key}}

func init() {
  gob.Register({{$structName}}{})
  cc.Register(cc.CommandIdentifier{
    CommandClass: cc.CommandClassID({{.CommandClass.Key}}),
    Command: cc.CommandID({{.Command.Key}}),
    Version: {{$version}},
  }, New{{$structName}})
}

func New{{$structName}}() cc.Command {
  return &{{$structName}}{}
}

// {{.Help}}
type {{$structName}} struct {
  {{range $_, $param := .Command.Params}}
    {{template "command-struct-fields" $param}}
  {{end}}
  {{range $_, $vg := .Command.VariantGroups}}
    {{ToGoName $vg.Name}} []{{$structName}}{{ToGoName $vg.Name}}
  {{end}}
}

{{range $_, $vg := .Command.VariantGroups}}
  type {{$structName}}{{ToGoName .Name}} struct {
    {{range $_, $param := .Params}}
      {{template "command-struct-fields" $param}}
    {{end}}
  }
{{end}}

func (cmd {{$structName}}) CommandClassID() cc.CommandClassID {
  return {{.CommandClass.Key}}
}

func (cmd {{$structName}}) CommandID() cc.CommandID {
  return Command{{$structName}}
}

func (cmd {{$structName}}) CommandIDString() string {
  return "{{.Command.Name}}"
}

func (cmd *{{$structName}}) UnmarshalBinary(data []byte) error {
  // According to the docs, we must copy data if we wish to retain it after returning
  {{if .Command.Params}}
  payload := make([]byte, len(data))
  copy(payload, data)

  if len(payload) < 2 {
    return errors.New("Payload length underflow")
  }

  {{template "unmarshal-command-params" .Command}}

  {{end}}
  return nil
}

func (cmd *{{$structName}}) MarshalBinary() (payload []byte, err error) {
  payload = make([]byte, 2)
  payload[0] = byte(cmd.CommandClassID())
  payload[1] = byte(cmd.CommandID())
  {{template "marshal-command-params" .Command}}
  return
}
